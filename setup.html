
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Setup &#8212; Smilei 73aaa37 documentation</title>
    <link rel="stylesheet" href="_static/smilei_theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '73aaa37',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/smileiIcon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Practical 1: Laser Propagation in vacuum" href="practical1.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" />
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
      scale: 95,
      availableFonts: ["TeX"]
    }
  });
  </script>
  
   

  </head>
  <body>

<div id="smallScreenMenu" class="off">

    
    <div class="toctree-smilei">
        <ul>
        </ul>
            <ul>
<li><a class="reference internal" href="#">Setup</a><ul>
<li><a class="reference internal" href="#obtain-smilei">Obtain Smilei</a></li>
<li><a class="reference internal" href="#prepare-the-environment">Prepare the environment</a></li>
<li><a class="reference internal" href="#compile-smilei">Compile Smilei</a></li>
<li><a class="reference internal" href="#how-to-run-a-simulation">How to run a simulation</a></li>
<li><a class="reference internal" href="#tips">Tips</a></li>
</ul>
</li>
</ul>

        <ul>
        </ul>
        <hr />
        <ul>
          <li class="outer">
              <a href="practical1.html">Tutorial 1</a>
          </li>
          <li class="outer">
              <a href="practical2.html">Tutorial 2</a>
          </li>
          <li class="outer">
              <a href="practical3.html">Tutorial 3</a>
          </li>
          <li class="outer">
              <a href="practical4.html">Tutorial 4</a>
          </li>
        </ul>
        <hr />
        <ul>
          <li class="outer">
              <a href="advanced_practical1.html">Advanced tutorial 1</a>
          </li>
          <li class="outer">
              <a href="advanced_practical2.html">Advanced tutorial 2</a>
          </li>
          <li class="outer">
              <a href="advanced_practical3.html">Advanced tutorial 3</a>
          </li>
          <li class="outer">
              <a href="advanced_practical4.html">Advanced tutorial 4</a>
          </li>
        </ul>
    </div>

</div>
<div id="hcontainer">
    <div id="nav_positioner">
        <div id="nav">
            <div id="nav_button" onclick="toggleNav()">
                Sections
            </div>
            <div id="nav_list" class="toctree-smilei">
                <div id="nav_title"><a href="#">Setup</a></div>
                <ul>
<li><a class="reference internal" href="#">Setup</a><ul>
<li><a class="reference internal" href="#obtain-smilei">Obtain Smilei</a></li>
<li><a class="reference internal" href="#prepare-the-environment">Prepare the environment</a></li>
<li><a class="reference internal" href="#compile-smilei">Compile Smilei</a></li>
<li><a class="reference internal" href="#how-to-run-a-simulation">How to run a simulation</a></li>
<li><a class="reference internal" href="#tips">Tips</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    </div>
    
    <div class="headercolor">
    </div>
    <div class="hpositioner">
        <div class="header">
        <div class="logo">
            <a href="index.html">
                <img class="logo" src="_static/smileiLogo_tutorials.svg" alt="Logo" />
            </a>
        </div>
        
    
            
        
        <div class="menu" id="menu_Setup" style="font-weight:bold">
            <div class="menuButton" onmouseenter="thisMenuOnly('menu_Setup')" onclick="toggleMenu('menu_Setup')" onmousedown="event.preventDefault()">
                <span>Info</span>
            </div>
            <div class="off">
                <div class="toctree-smilei">
                    <ul>
                        <li >
                            <a href="#">Setup</a>
                        </li>
            
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="menu" id="menu_Tutorial 1">
            <div class="menuButton" onmouseenter="thisMenuOnly('menu_Tutorial 1')" onclick="toggleMenu('menu_Tutorial 1')" onmousedown="event.preventDefault()">
                <span>Basic</span>
            </div>
            <div class="off">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="practical1.html">Tutorial 1</a>
                        </li>
                        <li class="outer">
                            <a href="practical2.html">Tutorial 2</a>
                        </li>
                        <li class="outer">
                            <a href="practical3.html">Tutorial 3</a>
                        </li>
                        <li class="outer">
                            <a href="practical4.html">Tutorial 4</a>
                        </li>
            
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="menu" id="menu_Advanced tutorial 1">
            <div class="menuButton" onmouseenter="thisMenuOnly('menu_Advanced tutorial 1')" onclick="toggleMenu('menu_Advanced tutorial 1')" onmousedown="event.preventDefault()">
                <span>Advanced</span>
            </div>
            <div class="off">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="advanced_practical1.html">Advanced tutorial 1</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_practical2.html">Advanced tutorial 2</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_practical3.html">Advanced tutorial 3</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_practical4.html">Advanced tutorial 4</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="searchbox" role="search" style="display:none">
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" placeholder="Search" id="searchinput" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
        
        <div id="searchicon" onclick="openSearch()" style="display:block">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g transform="translate(0,-932.36216)" >
                <circle
                   r="25" cy="977.51044" cx="38.078663"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <rect
                   transform="matrix(0.36717877,0.93015039,-0.93427297,0.35655858,0,0)"
                   rx="4.9996676" ry="7.4995141"
                   y="316.16959" x="947.6142"
                   height="14.117695" width="46.476151"
                   style="opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;" />
                <path
                   d="m 41.383282,962.25996 a 15,15 0 0 1 11.660107,11.6355"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke-width:3;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
              </g>
            </svg>
        </div>
        <div id="closesearchicon" onclick="closeSearch()" style="display:none">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g
                 transform="translate(0,-932.36216)">
                <path
                   d="m 10,962.36216 60,60.00004"
                   style="fill:none;stroke:#ffffff;stroke-width:10;stroke-linecap:round;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none" />
                <path
                   d="M 70,962.36216 10,1022.3622"
                   style="fill:none;stroke:#ffffff;stroke-width:10;stroke-linecap:round;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none" />
              </g>
            </svg>
        </div>
        
        <div id="smallScreenMenuButton" onclick="toggleSmallScreenMenu()">
            <svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
               viewBox="-20 -20 140 140">
              <g  style="fill:#ffffff;stroke:none;">
                <circle cx="15" cy="20" r="5" />
                <circle cx="35" cy="20" r="5" />
                <circle cx="85" cy="20" r="5" />
                <rect width="50" height="10" x="35" y="15" rx="0" ry="0" />
                <circle cx="15" cy="40" r="5" />
                <circle cx="35" cy="40" r="5" />
                <circle cx="85" cy="40" r="5" />
                <rect width="50" height="10" x="35" y="35" rx="0" ry="0" />
                <circle cx="15" cy="60" r="5" />
                <circle cx="35" cy="60" r="5" />
                <circle cx="85" cy="60" r="5" />
                <rect width="50" height="10" x="35" y="55" rx="0" ry="0" />
                <circle cx="15" cy="80" r="5" />
                <circle cx="35" cy="80" r="5" />
                <circle cx="85" cy="80" r="5" />
                <rect width="50" height="10" x="35" y="75" rx="0" ry="0" />
              </g>
            </svg>
        </div>
        
    </div>
    
</div>
</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="practical1.html" title="Practical 1: Laser Propagation in vacuum"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Smilei 73aaa37 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
    <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body" role="main">
          
  <div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p>In these tutorials, we assume you are running on a UNIX machine that has access to internet
and can run simulation jobs on several cores. Ideally, it would run on 16 to 32 cores.
If you are, instead, using a home computer or workstation, we recommend you scale the
simulations down in order to reduce their execution time.</p>
<p>We recommend getting some <a class="reference external" href="http://www.maisondelasimulation.fr/smilei/parallelization.html">basic understanding of parallel computing</a> and some basic knowledge
on UNIX commands.</p>
<p>You should first open a <cite>terminal</cite> or a <cite>console</cite>, then <code class="docutils literal"><span class="pre">cd</span></code> to the directory of your
choice.</p>
<hr class="docutils" />
<div class="section" id="obtain-smilei">
<h2>Obtain Smilei<a class="headerlink" href="#obtain-smilei" title="Permalink to this headline">¶</a></h2>
<p>The following <code class="docutils literal"><span class="pre">git</span></code> command downloads the code into the <code class="docutils literal"><span class="pre">Smilei</span></code> directory, located
in the current working directory.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone --depth<span class="o">=</span><span class="m">1</span> https://github.com/SmileiPIC/Smilei.git
$ <span class="nb">cd</span> Smilei
</pre></div>
</div>
<p>Now that you are in the main <code class="docutils literal"><span class="pre">Smilei</span></code> folder, you may compile the documentation using
the <cite>sphinx</cite> python package. If you do not have <cite>sphinx</cite> installed with your <cite>python</cite>
environment, <a class="reference external" href="http://www.sphinx-doc.org/en/stable/install.html">check this out</a>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ make doc
$ firefox build/html/index.html <span class="p">&amp;</span>
</pre></div>
</div>
<p>Change <code class="docutils literal"><span class="pre">firefox</span></code> to your favorite web browser.</p>
</div>
<hr class="docutils" />
<div class="section" id="prepare-the-environment">
<h2>Prepare the environment<a class="headerlink" href="#prepare-the-environment" title="Permalink to this headline">¶</a></h2>
<p>The environment should be ready to accomodate for Smilei’s installation. The dependencies
that are required for Smilei are listed in
<a class="reference external" href="http://www.maisondelasimulation.fr/smilei/installation.html">this page</a>.</p>
<p>In short, you need a <cite>C++11</cite> compiler, a compatible <cite>MPI</cite> library, a compatible <cite>HDF5</cite>
library, and <cite>python 2.7+</cite>. We do not provide a full explanation on how to install these
on all systems, but the link above gives a few examples.</p>
<p>We recommend that your <cite>C++</cite> compiler supports <cite>OpenMP</cite>, which allows for several threads
to operate in each process. This makes simulations potentially much faster.
Note that this requires the <code class="docutils literal"><span class="pre">MPI_THREAD_MULTIPLE</span></code> option
when the MPI library is compiled. In order to setup the <cite>OpenMP</cite> environment, we
recommend the following commands, that you may include in your <code class="docutils literal"><span class="pre">.bash_profile</span></code> or
<code class="docutils literal"><span class="pre">.bashrc</span></code> configuration files (or the relevant one on your system).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">8</span>
<span class="nb">export</span> <span class="nv">OMP_SCHEDULE</span><span class="o">=</span>dynamic
<span class="nb">export</span> <span class="nv">OMP_PROC_BIND</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>The number <code class="docutils literal"><span class="pre">8</span></code> above indicates the number of threads per process. For most systems,
the ideal number is equal to the number of cores contained in one <cite>node</cite> or <cite>socket</cite>.
For example, if your machine has 12 cores that share the same memory, we recommend using
<code class="docutils literal"><span class="pre">OMP_NUM_THREADS=12</span></code>.</p>
</div>
<hr class="docutils" />
<div class="section" id="compile-smilei">
<h2>Compile Smilei<a class="headerlink" href="#compile-smilei" title="Permalink to this headline">¶</a></h2>
<p>Once all dependencies are installed, go to the <code class="docutils literal"><span class="pre">Smilei</span></code> directory. You should be able
to run the following command to compile <cite>Smilei</cite>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ make -j <span class="m">8</span>
</pre></div>
</div>
<p>The option <code class="docutils literal"><span class="pre">-j</span> <span class="pre">8</span></code> simply indicates that the compilation with use 8 threads (faster).
When the compilation has succeeded, two executables are created: <code class="docutils literal"><span class="pre">smilei</span></code>
and <code class="docutils literal"><span class="pre">smilei_test</span></code>.</p>
</div>
<hr class="docutils" id="runsimulation" />
<div class="section" id="how-to-run-a-simulation">
<h2>How to run a simulation<a class="headerlink" href="#how-to-run-a-simulation" title="Permalink to this headline">¶</a></h2>
<p>When running <cite>Smilei</cite> on your own computer, you may use the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Make a new folder and go inside</span>
mkdir mysimulation
<span class="nb">cd</span> mysimulation
<span class="c1"># Copy necessary executables to the new folder</span>
cp /path/to/Smilei/smilei .
cp /path/to/Smilei/smilei_test .
<span class="c1"># Copy the input file as well</span>
cp /path/to/my_input.py .
<span class="c1"># Run the simulation on 4 processes</span>
mpirun -n <span class="m">4</span> smilei my_input.py
</pre></div>
</div>
<p>In this example, the simulation will use 4 processes, but remember that the option above
<code class="docutils literal"><span class="pre">OMP_NUM_THREADS=8</span></code> will set 8 threads in each process, so a total of 24 threads.
As a consequence, this example is ideal for 4 nodes containing each 8 cores.</p>
<p>Most supercomputers provide two different options to run a simulation. Both are relevant
to this tutorial. You may choose either.</p>
<ol class="arabic simple">
<li><strong>Run in interactive mode:</strong> you may request a few nodes of the machine for a given amount
of time. You will have access interactively to the processes, so that the commands above
can be directly written in the command line to run the simulation. Instead of copying
the commands each time, <strong>you may use the script</strong> <code class="docutils literal"><span class="pre">smilei.sh</span></code>
<strong>already available in</strong> <code class="docutils literal"><span class="pre">/path/to/Smilei/</span></code>.
See <a class="reference external" href="http://www.maisondelasimulation.fr/smilei/run.html#using-the-provided-script">help here</a>.</li>
<li><strong>Prepare a submission file</strong> to submit a “job”. You machine administrator should provide
you with a typical job submission file. It defines the number of nodes and cores that
you want to reserve. The command lines above have to be included in this file.</li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="tips">
<h2>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Launch a parallel interactive session:</p>
<p>One hour with 2 nodes, 8 processors per node, on the <code class="docutils literal"><span class="pre">default</span></code> queue:</p>
<ul>
<li><div class="first line-block">
<div class="line">with the <em>torque</em> (PBS) scheduler:</div>
<div class="line"><code class="docutils literal"><span class="pre">qsub</span> <span class="pre">-I</span> <span class="pre">-l</span> <span class="pre">walltime=01:00:00,nodes=2:ppn=8</span> <span class="pre">-q</span> <span class="pre">default</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">with the <em>slurm</em> scheduler:</div>
<div class="line"><code class="docutils literal"><span class="pre">srun</span> <span class="pre">-p</span> <span class="pre">default</span> <span class="pre">-I</span> <span class="pre">-N</span> <span class="pre">2</span> <span class="pre">-c</span> <span class="pre">8</span> <span class="pre">--pty</span> <span class="pre">-t</span> <span class="pre">0-01:00</span></code></div>
</div>
</li>
<li><p class="first">with <a class="reference external" href="https://www.ibm.com/support/knowledgecenter/SSFJTW_5.1.0/com.ibm.cluster.loadl.v5r1.load500.doc/am2cr_llrun.htm">intel’s LoadLeveler</a></p>
</li>
</ul>
</li>
<li><p class="first">Download a file from this webpage to your machine</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl -O http://URL/of/the/file
</pre></div>
</div>
</li>
</ul>
</div>
</div>


        </div></div>
      </div>
    </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="practical1.html" title="Practical 1: Laser Propagation in vacuum"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Smilei 73aaa37 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      <div>
      <a href="site.html">Site index</a>
      </div>
      <div>
        Last updated on Jan 11, 2018
      </div>
      
      <div>
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      </div>
      
    </div>
    
    <script type="text/javascript">
        
        var nav_list = document.getElementById("nav_list");
        var nav_button = document.getElementById("nav_button");
        var smallScreenMenu = document.getElementById("smallScreenMenu");
        var smallScreenMenuButton = document.getElementById("smallScreenMenuButton");
        var searchicon = document.getElementById("searchicon");
        var searchbox  = document.getElementById("searchbox");
        var searchinput= document.getElementById("searchinput");
        var menus = document.getElementsByClassName("menu");
        for( var i=0; i<menus.length; i++ )
            menus[i].active = false;
        
        
        var ul = nav_list.getElementsByTagName("ul")[0], li;
        var keep_nav = false;
        if( ul ) {
            li = ul.firstElementChild;
            if( li ) {
                if( li.getElementsByTagName("ul").length > 0 ) keep_nav = true;
            }
        }
        if( keep_nav ) {
            li.removeChild( li.firstElementChild );
        } else {
            document.getElementById("nav_positioner").removeChild( document.getElementById("nav") );
        }
        
        function navOff() {
            nav_list.style.display = "none";
            nav_button.className = "";
        }
        
        function toggleNav() {
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
            if( nav_list.style.display != "inline-block" ) {
                nav_list.style.display = "inline-block";
                nav_button.className = "pushed";
            } else {
                navOff();
            }
        }
        
        function toggleSmallScreenMenu() {
            if( smallScreenMenu.className != "on" ) {
                smallScreenMenu.className = "on";
                smallScreenMenuButton.className = "pushed";
            } else {
                smallScreenMenu.className = "off";
                smallScreenMenuButton.className = "";
            }
        }
        
        function menuOn( menu ) {
            var divs = menu.getElementsByTagName("div");
            if(nav_list) navOff();
            divs[1].className = "on";
            divs[0].className = "menuButton pushed";
            menu.active = true;
        }
        function menuOff( menu ) {
            var divs = menu.getElementsByTagName("div");
            divs[1].className = "off";
            divs[0].className = "menuButton";
            menu.active = false;
        }
        
        function thisMenuOnly(menu_id) {
            var menu = document.getElementById(menu_id);
            for( var i=0; i<menus.length; i++ )
                if( i!=menu_id )
                    menuOff( menus[i] );
            menuOn( menu );
        }
        
        function toggleMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            if( menu.active ) {
                menuOff( menu );
            } else {
                for( var i=0; i<menus.length; i++ )
                    if( i!=menu_id )
                        menuOff( menus[i] );
                menuOn( menu );
            }
        }
        
        function openSearch() {
            for( var i=0; i<menus.length; i++ ) {
                menuOff( menus[i] );
                menus[i].style.zIndex = "-1";
            }
            searchicon.style.display = "none";
            closesearchicon.style.display = "block";
            searchbox.style.display = "block";
            searchinput.focus();
        }
        
        function closeSearch() {
            searchicon.style.display = "block";
            closesearchicon.style.display = "none";
            searchbox .style.display = "none";
            for( var i=0; i<menus.length; i++ )
                menus[i].style.zIndex = "0";
        }
        
        
        var documentDiv = document.getElementsByClassName("document")[0];
        documentDiv.addEventListener('click', function (event) {
            if(nav_list) navOff();
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
        });
    </script>
  </body>
</html>